<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Shower Thoughts</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
* { box-sizing: border-box; }

:root {
  --bg: #f9f9f9;
  --card: #ffffff;
  --text: #111111;
  --subtext: #666666;
  --border: #cccccc;
  --button: #007aff;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0f0f10;
    --card: #1c1c1e;
    --text: #ffffff;
    --subtext: #9a9a9a;
    --border: #2c2c2e;
    --button: #0a84ff;
  }
}

:root[data-theme="light"] {
  --bg: #f9f9f9;
  --card: #ffffff;
  --text: #111111;
  --subtext: #666666;
  --border: #cccccc;
  --button: #007aff;
}

:root[data-theme="dark"] {
  --bg: #0f0f10;
  --card: #1c1c1e;
  --text: #ffffff;
  --subtext: #9a9a9a;
  --border: #2c2c2e;
  --button: #0a84ff;
}
  
body {
  font-family: -apple-system, system-ui;
  padding: 1rem;
  background: var(--bg);
  color: var(--text);
}

h1 {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  text-align: center;
}

textarea, button {
  width: 100%;
  font-size: 1rem;
}

textarea {
  padding: .75rem;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
}

button {
  margin-top: .5rem;
  padding: .75rem;
  background: var(--button);
  color: white;
  border: none;
  border-radius: 10px;
}

.toggle {
  background: none;
  color: var(--subtext);
  font-size: .9rem;
  margin-bottom: .75rem;
}

ul {
  list-style: none;
  padding: 0;
  margin-top: 1rem;
}

li {
  background: var(--card);
  padding: .75rem;
  border-radius: 10px;
  margin-bottom: .75rem;

  position: relative;
  overflow: hidden;
  touch-action: pan-y;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

li.swiping {
  transition: none;
}

li.delete {
  transform: translateX(-100%);
  opacity: 0;
}


.time {
  font-size: .8rem;
  color: var(--subtext);
  margin-bottom: .25rem;
}
</style>
</head>

<body>
<h1>Shower Thoughts</h1>
<button class="toggle" onclick="toggleTheme()">change theme</button>

<textarea id="input" rows="4" placeholder="write your thoughtâ€¦"></textarea>
<button onclick="saveThought()">shower</button>

<ul id="list"></ul>

<script>
const THEME_KEY = "theme";

function applyTheme(theme) {
  document.documentElement.dataset.theme = theme;
  if (theme === "dark") {
    document.documentElement.style.colorScheme = "dark";
  } else {
    document.documentElement.style.colorScheme = "light";
  }
}

function toggleTheme() {
  const current = localStorage.getItem(THEME_KEY);
  const next = current === "dark" ? "light" : "dark";
  localStorage.setItem(THEME_KEY, next);
  applyTheme(next);
}

// Apply saved theme on load
const savedTheme = localStorage.getItem(THEME_KEY);
if (savedTheme) applyTheme(savedTheme);

const KEY="thought_log";

const load=()=>JSON.parse(localStorage.getItem(KEY)||"[]");
const store=d=>localStorage.setItem(KEY,JSON.stringify(d));
const fmt=t=>new Date(t).toLocaleString();

function render() {
  list.innerHTML = "";

  const thoughts = load().slice().reverse();

  thoughts.forEach((entry, displayIndex) => {
    const li = document.createElement("li");

    const time = document.createElement("div");
    time.className = "time";
    time.textContent = fmt(entry.time);

    const text = document.createElement("div");
    text.textContent = entry.text;

    li.appendChild(time);
    li.appendChild(text);
    list.appendChild(li);

    // --- Swipe to delete logic ---
    let startX = 0;
    let startY = 0;
    let deltaX = 0;
    let swiping = false;

    li.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      li.classList.add("swiping");
    });

    li.addEventListener("touchmove", e => {
      deltaX = e.touches[0].clientX - startX;
      const deltaY = e.touches[0].clientY - startY;

      // Ignore vertical scroll
      if (Math.abs(deltaY) > Math.abs(deltaX)) return;

      if (deltaX < 0) {
        e.preventDefault();
        li.style.transform = `translateX(${deltaX}px)`;
        swiping = true;
      }
    });

    li.addEventListener("touchend", () => {
      li.classList.remove("swiping");

      // Swipe threshold
      if (swiping && deltaX < -80) {
        li.classList.add("delete");

        setTimeout(() => {
          const realIndex = load().length - 1 - displayIndex;
          const data = load();
          data.splice(realIndex, 1);
          store(data);
          render();
        }, 200);
      } else {
        li.style.transform = "";
      }

      swiping = false;
      deltaX = 0;
    });
  });
}

function saveThought(){
  if(!input.value.trim())return;
  const d=load();
  d.push({text:input.value.trim(),time:Date.now()});
  store(d);
  input.value="";
  render();
}

render();
window.addEventListener("load", () => {
  setTimeout(() => input.focus(), 300);
});

</script>
</body>
</html>
